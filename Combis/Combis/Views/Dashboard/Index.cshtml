@model IEnumerable<CommonLayer.DtoModells.UserDto>
<h2>User Dashboard</h2>
<table>
    <thead>
        <tr><th>Name</th><th>Email</th><th>Role</th><th>Action</th></tr>
    </thead>
    <tbody>
        @foreach (var user in Model)
        {
            <tr id="user-@user.Id">
                <td>@user.FullName</td>
                <td>@user.Email</td>
                <td>@user.Role</td>
                <td>
                    <!-- The Delete button triggers the AJAX request -->
                    <button class="delete-btn" data-user-id="@user.Id">Delete</button>
                </td>
            </tr>
        }
    </tbody>
</table>
<p>Want to see the API documentation? <a href="/swagger" target="_blank">View Swagger Docs</a></p>

<!-- Add the jQuery script at the bottom -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

<script>
    $(document).ready(function () {
        // Attach click event handler to delete buttons
        $('.delete-btn').click(function () {
            var userId = $(this).data('user-id');
            var row = $(this).closest('tr');

            // Confirm deletion before sending request
            if (confirm('Are you sure you want to delete this user?')) {
                // Perform the AJAX request to delete the user
                $.ajax({
                    url: '@Url.Action("Delete", "Dashboard")',  // Action for delete
                    type: 'POST',
                    data: {
                        id: userId,
                        __RequestVerificationToken: $('input[name="__RequestVerificationToken"]').val() // Anti-forgery token
                    },
                    success: function (response) {
                        // On success, remove the user row from the table
                        row.remove();
                        alert('User deleted successfully.');
                    },
                    error: function (xhr, status, error) {
                        alert('Error deleting user. Please try again.');
                    }
                });
            }
        });
    });
</script>
